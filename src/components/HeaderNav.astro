---
import HeaderLink from "./HeaderLink.astro";
import { SITE_TITLE, CDN_URL } from "@/consts";

const menus = [
  {
    href: "/news",
    title: "新闻",
  },
  // {
  //   href: "/guide",
  //   title: "攻略",
  // },
  {
    href: "/quest",
    title: "任务",
  },
  {
    href: "/build",
    title: "构建",
  },
  // {
  //   href: "/addon",
  //   title: "插件",
  // },
  {
    href: "/set",
    title: "套装",
  },
  {
    href: "/map",
    title: "地图",
  },
  {
    href: "/tool",
    title: "工具",
  },
  {
    href: "/about",
    title: "关于",
  },
];

const moreMenus = [
  {
    href: "/dlc",
    title: "DLC",
  },
  {
    href: "/chapter",
    title: "章节",
  },
];
---

<header
  id="page-top"
  class="px-3 h-12 md:h-20 text-gray-500 md:flex items-center md:px-8"
>
  <div class="flex justify-between items-center">
    <a class="flex items-center flex-shrink-0" href="/">
      <img src={`${CDN_URL}/ico/eso.ico`} alt="" />
      <span class="ml-4 text-2xl text-gray-900 font-bold">{SITE_TITLE}</span>
    </a>
    <label
      class="md:hidden ml-4 bg-transparent border-none cursor-pointer"
      for="fullscreennav-toggle"
      id="toggle-menu"
    >
      <svg viewBox="0 0 28 20" width="24" height="24">
        <rect width="28" height="4" rx="4"></rect>
        <rect y="8" width="28" height="4" rx="4"></rect>
        <rect y="16" width="28" height="4" rx="4"></rect>
      </svg>
    </label>
  </div>
  <nav class="items-center hidden md:flex">
    <ul
      class="flex flex-col md:flex-row md:self-center w-full text-xl md:text-base"
    >
      {
        menus.map(({ href, title }) => (
          <li class="ml-12">
            <HeaderLink href={href}>{title}</HeaderLink>
          </li>
        ))
      }
      <li class="relative ml-12">
        <button
          id="more-menu"
          type="button"
          class="text-gray-500 group inline-flex items-center rounded-md bg-white text-base font-medium hover:text-gray-900 focus:outline-none"
          aria-expanded="false"
        >
          <span>更多</span>
          <svg
            class="text-gray-400 ml-2 h-5 w-5 group-hover:text-gray-500"
            xmlns="http://www.w3.org/2000/svg"
            viewBox="0 0 20 20"
            fill="currentColor"
            aria-hidden="true"
          >
            <path
              fill-rule="evenodd"
              d="M5.23 7.21a.75.75 0 011.06.02L10 11.168l3.71-3.938a.75.75 0 111.08 1.04l-4.25 4.5a.75.75 0 01-1.08 0l-4.25-4.5a.75.75 0 01.02-1.06z"
              clip-rule="evenodd"></path>
          </svg>
        </button>

        <div
          class="hidden absolute z-10 mt-1 transform px-2 sm:px-0 lg:left-1/2 lg:ml-0 lg:-translate-x-1/2"
        >
          <div
            class="overflow-hidden rounded-lg shadow-lg ring-1 ring-black ring-opacity-5"
          >
            <div class="grid gap-1 bg-white py-4 px-8 sm:gap-4">
              {
                moreMenus.map(({ href, title }) => (
                  <HeaderLink href={href}>{title}</HeaderLink>
                ))
              }
            </div>
          </div>
        </div>
      </li>
    </ul>
  </nav>

  <script is:inline>
    window.onload = function () {
      const menuIcon = document.querySelector("#toggle-menu");
      menuIcon.addEventListener("click", () => {
        menuIcon.classList.toggle("expanded");
        document.body.classList.toggle("overflow-hidden");
        document.getElementById("page-top")?.classList.toggle("h-screen");
        document.querySelector("#page-top nav")?.classList.toggle("hidden");
        document.querySelector("#area-list")?.classList.toggle("hidden");
        document.querySelector("astro-island")?.classList.toggle("hidden");
        const matches = document.querySelectorAll("astro-island");
        if (matches && matches.length) {
          matches.forEach((elem) => {
            elem?.classList.toggle("hidden");
          });
        }
      });

      const moreMenu = document.querySelector("#more-menu");
      moreMenu.addEventListener("click", () => {
        moreMenu.classList.toggle("expanded");
        document.querySelector("#more-menu + div")?.classList.toggle("hidden");
      });
    };
  </script>
</header>
